@page "/"

@using Newtonsoft.Json
@using Cytoscape.NET
@using Cytoscape.NET.CytoscapeModel
@using Microsoft.FSharp.Collections

@inject HttpClient Http
@inject IJSRuntime JSRuntime

<PageTitle>Home</PageTitle>

<div id="cy" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

@code {
    private Cytoscape? _graph;
    
    // This tries to load the graph on startup
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Assuming _graph is initialized elsewhere
            await RenderGraphAsync();
        }
    }

    private async Task RenderGraphAsync()
    {
        _graph = CyGraph.initEmpty();
        
        var options = new JsonSerializerSettings { ReferenceLoopHandling = ReferenceLoopHandling.Ignore };
        await JSRuntime.InvokeVoidAsync("renderCytoscapeGraph", JsonConvert.SerializeObject(_graph, options));
    }
}